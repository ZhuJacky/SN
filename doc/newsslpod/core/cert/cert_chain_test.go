package cert

import (
	"context"
	"crypto/x509"
	"testing"

	"mysslee_qcloud/brand"
	"mysslee_qcloud/config"
	"mysslee_qcloud/utils/certutils"

	log "github.com/sirupsen/logrus"
	"github.com/stretchr/testify/assert"
)

func TestGetCertChain(t *testing.T) {
	brand.Init(brand.BrandDB{
		Driver:          config.AppConf.DB.Driver,
		Source:          config.AppConf.DB.DataSourceName,
		TrustCAConfPath: config.TrustCAConfPath,
		TrustCALockPath: config.TrustCALockPath,
	})
	chain, err := GetCertChain(context.Background(), certPEM1)
	if err != nil {
		t.Fatal(err)
	}

	t.Log(chain)
}

var (
	// RSA
	certPEM1 = [][]byte{
		[]byte(`-----BEGIN CERTIFICATE-----
MIIFfjCCBGagAwIBAgIQaljN3EMQwO3LWqzsTggeVDANBgkqhkiG9w0BAQsFADCB
lDELMAkGA1UEBhMCVVMxHTAbBgNVBAoTFFN5bWFudGVjIENvcnBvcmF0aW9uMR8w
HQYDVQQLExZTeW1hbnRlYyBUcnVzdCBOZXR3b3JrMR0wGwYDVQQLExREb21haW4g
VmFsaWRhdGVkIFNTTDEmMCQGA1UEAxMdU3ltYW50ZWMgQmFzaWMgRFYgU1NMIENB
IC0gRzEwHhcNMTcwODA3MDAwMDAwWhcNMTgwODA3MjM1OTU5WjAcMRowGAYDVQQD
DBFib3NzLml5dW54aWFvLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
ggEBALGRJquHTqtcDvwMYdF53VIaBT/kFdnHkGpjHAQcIl676hrnq3ZoJwi8Gajn
fg2zVrNvtARzHyAiolcbwJ2msKKFgaFDP8g76Ao0UW95z7iKUOG9nRh5Gd2s8qaN
/yS/MlpkR7O8m5WXxRbAmJxC7PMOcYzgTxUO5Apzmo5qtQM2kUUU0rXcB6M8AJgx
C4hWp1vj8BehWhWLR6pWIfVbVmnqLMfr/qkwT9aPiop6dv+RNWRuhcZPlAqd9owQ
gsFT+jhBApLNq7BXSbn4iuzk0SzRtrwLDamzqAkJZxHXVL0aR6Nb+qxEb37S/u/j
dYAmU2MGh74gIGEzYACTIL0FB4ECAwEAAaOCAkEwggI9MBwGA1UdEQQVMBOCEWJv
c3MuaXl1bnhpYW8uY29tMAkGA1UdEwQCMAAwYQYDVR0gBFowWDBWBgZngQwBAgEw
TDAjBggrBgEFBQcCARYXaHR0cHM6Ly9kLnN5bWNiLmNvbS9jcHMwJQYIKwYBBQUH
AgIwGQwXaHR0cHM6Ly9kLnN5bWNiLmNvbS9ycGEwHwYDVR0jBBgwFoAUXGGesHZB
qWqqQwvhx24wKW6xzTYwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUF
BwMBBggrBgEFBQcDAjBXBggrBgEFBQcBAQRLMEkwHwYIKwYBBQUHMAGGE2h0dHA6
Ly9oYy5zeW1jZC5jb20wJgYIKwYBBQUHMAKGGmh0dHA6Ly9oYy5zeW1jYi5jb20v
aGMuY3J0MIIBBAYKKwYBBAHWeQIEAgSB9QSB8gDwAHUA3esdK3oNT6Ygi4GtgWhw
fi6OnQHVXIiNPRHEzbbsvswAAAFdu2wA2gAABAMARjBEAiAwjXyk9ghysERr7ni5
5RE9+PIfek2lee2xVcM2hJcrzQIgPM14nfZKtIpcSii7njeKLW2kstXiGI27aJHj
7E5/fG4AdwCkuQmQtBhYFIe7E6LMZ3AKPDWYBPkb37jjd80OyA3cEAAAAV27bAET
AAAEAwBIMEYCIQCtAERoPvaPkFTCzoske8MBtbJ4qEVlbEpbVIS5ylDMlgIhAIb0
8Dpmwi51h6O1BZiAyS20FNfvCzhkISb4cbL9cHETMA0GCSqGSIb3DQEBCwUAA4IB
AQCQAgW2zwbI38H8WRNCT2W/EIgE2ciXCBMLDADNyB56SQS5M7TcVXVYci/MOrg6
N6waI0jyUKZ+O7izk0c3GWyRzFnAj7ttg5z9df7b9y1RkgQX+LSiv6vx6EA/oei0
LkGvEDlJviC79yYj3t4IwMz+kFHYzNXMqL4Nh0moXPm+AzGM/UC9+bPFDkqqAXAw
vcXzCTf1QLv/UOcHLK53xOiqpIp04ze0FiaFcaMHIyZT+gjT3iIiYYuv1VXuZv0b
T2SkyX/mM21xGV5C0Af5h+rdp2w/Mcs0F6JBo0Q4YgIDl9sGCY6fIuWNpRB2t1V6
mqQJ6qfm0yC9Nm+3sNU4f9bO
-----END CERTIFICATE-----`),
	}
	// resp1
	/*
	   -----BEGIN CERTIFICATE-----
	   MIIFfjCCBGagAwIBAgIQaljN3EMQwO3LWqzsTggeVDANBgkqhkiG9w0BAQsFADCB
	   lDELMAkGA1UEBhMCVVMxHTAbBgNVBAoTFFN5bWFudGVjIENvcnBvcmF0aW9uMR8w
	   HQYDVQQLExZTeW1hbnRlYyBUcnVzdCBOZXR3b3JrMR0wGwYDVQQLExREb21haW4g
	   VmFsaWRhdGVkIFNTTDEmMCQGA1UEAxMdU3ltYW50ZWMgQmFzaWMgRFYgU1NMIENB
	   IC0gRzEwHhcNMTcwODA3MDAwMDAwWhcNMTgwODA3MjM1OTU5WjAcMRowGAYDVQQD
	   DBFib3NzLml5dW54aWFvLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
	   ggEBALGRJquHTqtcDvwMYdF53VIaBT/kFdnHkGpjHAQcIl676hrnq3ZoJwi8Gajn
	   fg2zVrNvtARzHyAiolcbwJ2msKKFgaFDP8g76Ao0UW95z7iKUOG9nRh5Gd2s8qaN
	   /yS/MlpkR7O8m5WXxRbAmJxC7PMOcYzgTxUO5Apzmo5qtQM2kUUU0rXcB6M8AJgx
	   C4hWp1vj8BehWhWLR6pWIfVbVmnqLMfr/qkwT9aPiop6dv+RNWRuhcZPlAqd9owQ
	   gsFT+jhBApLNq7BXSbn4iuzk0SzRtrwLDamzqAkJZxHXVL0aR6Nb+qxEb37S/u/j
	   dYAmU2MGh74gIGEzYACTIL0FB4ECAwEAAaOCAkEwggI9MBwGA1UdEQQVMBOCEWJv
	   c3MuaXl1bnhpYW8uY29tMAkGA1UdEwQCMAAwYQYDVR0gBFowWDBWBgZngQwBAgEw
	   TDAjBggrBgEFBQcCARYXaHR0cHM6Ly9kLnN5bWNiLmNvbS9jcHMwJQYIKwYBBQUH
	   AgIwGQwXaHR0cHM6Ly9kLnN5bWNiLmNvbS9ycGEwHwYDVR0jBBgwFoAUXGGesHZB
	   qWqqQwvhx24wKW6xzTYwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUF
	   BwMBBggrBgEFBQcDAjBXBggrBgEFBQcBAQRLMEkwHwYIKwYBBQUHMAGGE2h0dHA6
	   Ly9oYy5zeW1jZC5jb20wJgYIKwYBBQUHMAKGGmh0dHA6Ly9oYy5zeW1jYi5jb20v
	   aGMuY3J0MIIBBAYKKwYBBAHWeQIEAgSB9QSB8gDwAHUA3esdK3oNT6Ygi4GtgWhw
	   fi6OnQHVXIiNPRHEzbbsvswAAAFdu2wA2gAABAMARjBEAiAwjXyk9ghysERr7ni5
	   5RE9+PIfek2lee2xVcM2hJcrzQIgPM14nfZKtIpcSii7njeKLW2kstXiGI27aJHj
	   7E5/fG4AdwCkuQmQtBhYFIe7E6LMZ3AKPDWYBPkb37jjd80OyA3cEAAAAV27bAET
	   AAAEAwBIMEYCIQCtAERoPvaPkFTCzoske8MBtbJ4qEVlbEpbVIS5ylDMlgIhAIb0
	   8Dpmwi51h6O1BZiAyS20FNfvCzhkISb4cbL9cHETMA0GCSqGSIb3DQEBCwUAA4IB
	   AQCQAgW2zwbI38H8WRNCT2W/EIgE2ciXCBMLDADNyB56SQS5M7TcVXVYci/MOrg6
	   N6waI0jyUKZ+O7izk0c3GWyRzFnAj7ttg5z9df7b9y1RkgQX+LSiv6vx6EA/oei0
	   LkGvEDlJviC79yYj3t4IwMz+kFHYzNXMqL4Nh0moXPm+AzGM/UC9+bPFDkqqAXAw
	   vcXzCTf1QLv/UOcHLK53xOiqpIp04ze0FiaFcaMHIyZT+gjT3iIiYYuv1VXuZv0b
	   T2SkyX/mM21xGV5C0Af5h+rdp2w/Mcs0F6JBo0Q4YgIDl9sGCY6fIuWNpRB2t1V6
	   mqQJ6qfm0yC9Nm+3sNU4f9bO
	   -----END CERTIFICATE-----
	   -----BEGIN CERTIFICATE-----
	   MIIFYjCCBEqgAwIBAgIQTEzYoPxP6q4VVKh/CQ7ahzANBgkqhkiG9w0BAQsFADCB
	   yjELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQL
	   ExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrMTowOAYDVQQLEzEoYykgMjAwNiBWZXJp
	   U2lnbiwgSW5jLiAtIEZvciBhdXRob3JpemVkIHVzZSBvbmx5MUUwQwYDVQQDEzxW
	   ZXJpU2lnbiBDbGFzcyAzIFB1YmxpYyBQcmltYXJ5IENlcnRpZmljYXRpb24gQXV0
	   aG9yaXR5IC0gRzUwHhcNMTYwNjA3MDAwMDAwWhcNMjYwNjA2MjM1OTU5WjCBlDEL
	   MAkGA1UEBhMCVVMxHTAbBgNVBAoTFFN5bWFudGVjIENvcnBvcmF0aW9uMR8wHQYD
	   VQQLExZTeW1hbnRlYyBUcnVzdCBOZXR3b3JrMR0wGwYDVQQLExREb21haW4gVmFs
	   aWRhdGVkIFNTTDEmMCQGA1UEAxMdU3ltYW50ZWMgQmFzaWMgRFYgU1NMIENBIC0g
	   RzEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCkN8hYylrZCZihZgN2
	   5FsiT+qfOv8rKi3MbRIsZ2TUqsS5e1eDLPXI8IP4XXUZLWt9hlqmDpqiZa5mLSBj
	   KDX3iWq/FaOc8l1AsbeOhr9ZESCoEorqm6S9wAL+HX7hLY/7p03SSNSAO+/gr2o7
	   ciWu3jhd+H4dzGNNDN0nCuRIOX7rTGYI5mOb8QWJRC6H/3MlUYpBt9VV+l2FVNhB
	   LJuofF3TNJojVHximZnTEkybg/r9AZc2TkDHJX1BA6rNjXG8l5iSCL9ICJCBUPB5
	   z/s3hQBQkOALXN88QTIrlj53XpWpqxYdQJrOFbtWi18WW3ZAnGAscd8vZ5UIg3KL
	   AmoBAgMBAAGjggF2MIIBcjASBgNVHRMBAf8ECDAGAQH/AgEAMC8GA1UdHwQoMCYw
	   JKAioCCGHmh0dHA6Ly9zLnN5bWNiLmNvbS9wY2EzLWc1LmNybDAOBgNVHQ8BAf8E
	   BAMCAQYwLgYIKwYBBQUHAQEEIjAgMB4GCCsGAQUFBzABhhJodHRwOi8vcy5zeW1j
	   ZC5jb20wYQYDVR0gBFowWDBWBgZngQwBAgEwTDAjBggrBgEFBQcCARYXaHR0cHM6
	   Ly9kLnN5bWNiLmNvbS9jcHMwJQYIKwYBBQUHAgIwGRoXaHR0cHM6Ly9kLnN5bWNi
	   LmNvbS9ycGEwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMCkGA1UdEQQi
	   MCCkHjAcMRowGAYDVQQDExFTeW1hbnRlY1BLSS0yLTU1NTAdBgNVHQ4EFgQUXGGe
	   sHZBqWqqQwvhx24wKW6xzTYwHwYDVR0jBBgwFoAUf9Nlp8Ld7LvwMAnzQzn6Aq8z
	   MTMwDQYJKoZIhvcNAQELBQADggEBAGHqRXEvjeE/CpuVSPHyPKJYFsqWxP/a4quX
	   cRCRsy+ki4EP8qT7NfPnkEogxZvlMctHsWgdtTbp9ShXbqCnqXPCw575BZH2rEKN
	   xI30CWr6U47n4h2hSnaJxJeeA+xKsA1Vk4v8eLu7xwRlBwhZEsYNFAVpD3YEToek
	   H877QzZrZ6EdG/3Vg6sdtHDQ4i/U87syTmyM2l8vXOGIZDd1Wr6dqee2FtCfhvAc
	   WMbvh/J6sBOHMq0Vn5G8Tp6iUwsRlY1z7LaQKAlnlOiiZVhhe+1gvzJBHC0t+Hr2
	   2YHwaoKDLhSB0F/gGkziNQ+py1hFne4MEOuvzOxJpjn0+wRIbBk=
	   -----END CERTIFICATE-----
	*/

	// ECC
	certPEM2 = [][]byte{
		[]byte(`-----BEGIN CERTIFICATE-----
MIIGhjCCBiygAwIBAgIQE/jgnug+L3Cfs7RK+IhsQzAKBggqhkjOPQQDAjB/MQsw
CQYDVQQGEwJVUzEdMBsGA1UEChMUU3ltYW50ZWMgQ29ycG9yYXRpb24xHzAdBgNV
BAsTFlN5bWFudGVjIFRydXN0IE5ldHdvcmsxMDAuBgNVBAMTJ1N5bWFudGVjIENs
YXNzIDMgRUNDIDI1NiBiaXQgRVYgQ0EgLSBHMjAeFw0xNzA5MTgwMDAwMDBaFw0x
ODEyMTcyMzU5NTlaMIH2MRMwEQYLKwYBBAGCNzwCAQMTAkNOMRkwFwYLKwYBBAGC
NzwCAQITCFNoYW5naGFpMRYwFAYLKwYBBAGCNzwCAQETBVh1aHVpMR0wGwYDVQQP
ExRQcml2YXRlIE9yZ2FuaXphdGlvbjEbMBkGA1UEBRMSOTEzMTAxMDQwNjYwNDMx
OTM5MQswCQYDVQQGEwJDTjESMBAGA1UEBwwJ5LiK5rW35biCMTMwMQYDVQQKDCrk
uprmlbDkv6Hmga/np5HmioDvvIjkuIrmtbfvvInmnInpmZDlhazlj7gxGjAYBgNV
BAMMEXd3dy50cnVzdGFzaWEuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE
hZUT9NYIECXvRom0Qp9EHN0/jQMCPnxDkWVnxib29ImOiAO3j/TP+pC9RA0vMwz/
lIJbohNv3rd7kvb6U/02faOCBBAwggQMMIIBMgYDVR0RBIIBKTCCASWCGXhuLS1p
aHE1NGlxdGVtNmIzdWZsenQuY26CCGh0dHBzLmNuggx3d3cuaHR0cHMuY26CDmFs
d2F5c29uc3NsLmNughJ3d3cuYWx3YXlzb25zc2wuY26CFnhuLS1qbHF5NGFqNzVk
NmYxYS5jb22CD20udHJ1c3Rhc2lhLmNvbYISbXBraS50cnVzdGFzaWEuY29tghZz
eW1hbnRlYy50cnVzdGFzaWEuY29tghZzc2xjbG91ZC50cnVzdGFzaWEuY29tghd0
cnVzdHNlYWwudHJ1c3Rhc2lhLmNvbYIRZWNjLnRydXN0YXNpYS5jb22CEXNzbC50
cnVzdGFzaWEuY29tghF3d3cudHJ1c3Rhc2lhLmNvbYINdHJ1c3Rhc2lhLmNvbTAJ
BgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDBvBgNVHSAEaDBmMFsGC2CGSAGG+EUB
BxcGMEwwIwYIKwYBBQUHAgEWF2h0dHBzOi8vZC5zeW1jYi5jb20vY3BzMCUGCCsG
AQUFBwICMBkMF2h0dHBzOi8vZC5zeW1jYi5jb20vcnBhMAcGBWeBDAEBMCsGA1Ud
HwQkMCIwIKAeoByGGmh0dHA6Ly9yZC5zeW1jYi5jb20vcmQuY3JsMB0GA1UdJQQW
MBQGCCsGAQUFBwMBBggrBgEFBQcDAjAfBgNVHSMEGDAWgBRycjbGpzGeh4nHMn3s
OvWiZD94ejBXBggrBgEFBQcBAQRLMEkwHwYIKwYBBQUHMAGGE2h0dHA6Ly9yZC5z
eW1jZC5jb20wJgYIKwYBBQUHMAKGGmh0dHA6Ly9yZC5zeW1jYi5jb20vcmQuY3J0
MIIBgAYKKwYBBAHWeQIEAgSCAXAEggFsAWoAdwDd6x0reg1PpiCLga2BaHB+Lo6d
AdVciI09EcTNtuy+zAAAAV6ShHGjAAAEAwBIMEYCIQCsPr4l8frfTBQlnJCBCFEC
cZhpHaPEVC3xHtXEcPzyhwIhANqcnaa30V3GH+mxzbFvv1oQ4xAUSstuHnDr3VzY
7wALAHcApLkJkLQYWBSHuxOizGdwCjw1mAT5G9+443fNDsgN3BAAAAFekoRyGAAA
BAMASDBGAiEAsQ5ygfrX3lG1tqUFXvDaErS5rbhzfAUTemtAdQQQ2okCIQDi2xa4
cPNTFJ2qEKXOw78wBwegX9hiP+j4rLCYnwxMeQB2AO5Lvbd1zmC64UJpH6vhnmaj
D35fsHLYgwDEe4l6qP3LAAABXpKEc5sAAAQDAEcwRQIhAPdSYWxyOZ/jT6sGxpGs
uACNCsmdhotfd13wsnFQyJE/AiB8avVfNyXLXw6zxDJ469+CLTo2ezfJoc9bCxvp
op/TLTAKBggqhkjOPQQDAgNIADBFAiBioTzOccwRYHAFj8TV3WiWxJz8j1j9Q3Qz
umM1oCrGugIhANPtBotHRFTnCC3rA5htSD2RTYyCqtrZRtV2C9RiFtzT
-----END CERTIFICATE-----`),
	}

	// resp2 :
	/*
	   	-----BEGIN CERTIFICATE-----
	   MIIGhjCCBiygAwIBAgIQE/jgnug+L3Cfs7RK+IhsQzAKBggqhkjOPQQDAjB/MQsw
	   CQYDVQQGEwJVUzEdMBsGA1UEChMUU3ltYW50ZWMgQ29ycG9yYXRpb24xHzAdBgNV
	   BAsTFlN5bWFudGVjIFRydXN0IE5ldHdvcmsxMDAuBgNVBAMTJ1N5bWFudGVjIENs
	   YXNzIDMgRUNDIDI1NiBiaXQgRVYgQ0EgLSBHMjAeFw0xNzA5MTgwMDAwMDBaFw0x
	   ODEyMTcyMzU5NTlaMIH2MRMwEQYLKwYBBAGCNzwCAQMTAkNOMRkwFwYLKwYBBAGC
	   NzwCAQITCFNoYW5naGFpMRYwFAYLKwYBBAGCNzwCAQETBVh1aHVpMR0wGwYDVQQP
	   ExRQcml2YXRlIE9yZ2FuaXphdGlvbjEbMBkGA1UEBRMSOTEzMTAxMDQwNjYwNDMx
	   OTM5MQswCQYDVQQGEwJDTjESMBAGA1UEBwwJ5LiK5rW35biCMTMwMQYDVQQKDCrk
	   uprmlbDkv6Hmga/np5HmioDvvIjkuIrmtbfvvInmnInpmZDlhazlj7gxGjAYBgNV
	   BAMMEXd3dy50cnVzdGFzaWEuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE
	   hZUT9NYIECXvRom0Qp9EHN0/jQMCPnxDkWVnxib29ImOiAO3j/TP+pC9RA0vMwz/
	   lIJbohNv3rd7kvb6U/02faOCBBAwggQMMIIBMgYDVR0RBIIBKTCCASWCGXhuLS1p
	   aHE1NGlxdGVtNmIzdWZsenQuY26CCGh0dHBzLmNuggx3d3cuaHR0cHMuY26CDmFs
	   d2F5c29uc3NsLmNughJ3d3cuYWx3YXlzb25zc2wuY26CFnhuLS1qbHF5NGFqNzVk
	   NmYxYS5jb22CD20udHJ1c3Rhc2lhLmNvbYISbXBraS50cnVzdGFzaWEuY29tghZz
	   eW1hbnRlYy50cnVzdGFzaWEuY29tghZzc2xjbG91ZC50cnVzdGFzaWEuY29tghd0
	   cnVzdHNlYWwudHJ1c3Rhc2lhLmNvbYIRZWNjLnRydXN0YXNpYS5jb22CEXNzbC50
	   cnVzdGFzaWEuY29tghF3d3cudHJ1c3Rhc2lhLmNvbYINdHJ1c3Rhc2lhLmNvbTAJ
	   BgNVHRMEAjAAMA4GA1UdDwEB/wQEAwIHgDBvBgNVHSAEaDBmMFsGC2CGSAGG+EUB
	   BxcGMEwwIwYIKwYBBQUHAgEWF2h0dHBzOi8vZC5zeW1jYi5jb20vY3BzMCUGCCsG
	   AQUFBwICMBkMF2h0dHBzOi8vZC5zeW1jYi5jb20vcnBhMAcGBWeBDAEBMCsGA1Ud
	   HwQkMCIwIKAeoByGGmh0dHA6Ly9yZC5zeW1jYi5jb20vcmQuY3JsMB0GA1UdJQQW
	   MBQGCCsGAQUFBwMBBggrBgEFBQcDAjAfBgNVHSMEGDAWgBRycjbGpzGeh4nHMn3s
	   OvWiZD94ejBXBggrBgEFBQcBAQRLMEkwHwYIKwYBBQUHMAGGE2h0dHA6Ly9yZC5z
	   eW1jZC5jb20wJgYIKwYBBQUHMAKGGmh0dHA6Ly9yZC5zeW1jYi5jb20vcmQuY3J0
	   MIIBgAYKKwYBBAHWeQIEAgSCAXAEggFsAWoAdwDd6x0reg1PpiCLga2BaHB+Lo6d
	   AdVciI09EcTNtuy+zAAAAV6ShHGjAAAEAwBIMEYCIQCsPr4l8frfTBQlnJCBCFEC
	   cZhpHaPEVC3xHtXEcPzyhwIhANqcnaa30V3GH+mxzbFvv1oQ4xAUSstuHnDr3VzY
	   7wALAHcApLkJkLQYWBSHuxOizGdwCjw1mAT5G9+443fNDsgN3BAAAAFekoRyGAAA
	   BAMASDBGAiEAsQ5ygfrX3lG1tqUFXvDaErS5rbhzfAUTemtAdQQQ2okCIQDi2xa4
	   cPNTFJ2qEKXOw78wBwegX9hiP+j4rLCYnwxMeQB2AO5Lvbd1zmC64UJpH6vhnmaj
	   D35fsHLYgwDEe4l6qP3LAAABXpKEc5sAAAQDAEcwRQIhAPdSYWxyOZ/jT6sGxpGs
	   uACNCsmdhotfd13wsnFQyJE/AiB8avVfNyXLXw6zxDJ469+CLTo2ezfJoc9bCxvp
	   op/TLTAKBggqhkjOPQQDAgNIADBFAiBioTzOccwRYHAFj8TV3WiWxJz8j1j9Q3Qz
	   umM1oCrGugIhANPtBotHRFTnCC3rA5htSD2RTYyCqtrZRtV2C9RiFtzT
	   -----END CERTIFICATE-----
	   -----BEGIN CERTIFICATE-----
	   MIIEYjCCA0qgAwIBAgIQcSI8pSIYXqxEzxdw0aiqXTANBgkqhkiG9w0BAQsFADCB
	   yjELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQL
	   ExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrMTowOAYDVQQLEzEoYykgMjAwNiBWZXJp
	   U2lnbiwgSW5jLiAtIEZvciBhdXRob3JpemVkIHVzZSBvbmx5MUUwQwYDVQQDEzxW
	   ZXJpU2lnbiBDbGFzcyAzIFB1YmxpYyBQcmltYXJ5IENlcnRpZmljYXRpb24gQXV0
	   aG9yaXR5IC0gRzUwHhcNMTUwNTEyMDAwMDAwWhcNMjUwNTExMjM1OTU5WjB/MQsw
	   CQYDVQQGEwJVUzEdMBsGA1UEChMUU3ltYW50ZWMgQ29ycG9yYXRpb24xHzAdBgNV
	   BAsTFlN5bWFudGVjIFRydXN0IE5ldHdvcmsxMDAuBgNVBAMTJ1N5bWFudGVjIENs
	   YXNzIDMgRUNDIDI1NiBiaXQgRVYgQ0EgLSBHMjBZMBMGByqGSM49AgEGCCqGSM49
	   AwEHA0IABC93+aAYNSQS+F5P39qxy3AhmkNBfnYME9lyISEJCvfrBSSiVc2ySA6v
	   e6GH2RRknqCtxX85cEyaQgABoxYHiL2jggFXMIIBUzASBgNVHRMBAf8ECDAGAQH/
	   AgEAMC8GA1UdHwQoMCYwJKAioCCGHmh0dHA6Ly9zLnN5bWNiLmNvbS9wY2EzLWc1
	   LmNybDAOBgNVHQ8BAf8EBAMCAQYwLgYIKwYBBQUHAQEEIjAgMB4GCCsGAQUFBzAB
	   hhJodHRwOi8vcy5zeW1jZC5jb20wXwYDVR0gBFgwVjBUBgRVHSAAMEwwIwYIKwYB
	   BQUHAgEWF2h0dHBzOi8vZC5zeW1jYi5jb20vY3BzMCUGCCsGAQUFBwICMBkaF2h0
	   dHBzOi8vZC5zeW1jYi5jb20vcnBhMCsGA1UdEQQkMCKkIDAeMRwwGgYDVQQDExNT
	   WU1DLUVDQy1DQS1wMjU2LTIzMB0GA1UdDgQWBBRycjbGpzGeh4nHMn3sOvWiZD94
	   ejAfBgNVHSMEGDAWgBR/02Wnwt3su/AwCfNDOfoCrzMxMzANBgkqhkiG9w0BAQsF
	   AAOCAQEAOiHdrJlwGYxgg+Zh8ePYDYqFuLbuom7+myENWaZ+NIsKAkHheANBJWJA
	   Ot6t8TKkGp7G+YeDQ/oEZRGwYyIrQgi7gyZqmpcojna6Wp1OxF1KHotIDEAh/LBk
	   73jOaJglZVeodRO40nhARoHHB0eJlIWoA8DybXAjVRMW0fxmAvFb3pjuKjokQtE9
	   muqFQfr8proZ8BdhmMv41d5IRATmkUU5jGJzAbph4EuypmgXSIES0IHsMxNxwJjU
	   ufpCh8h4dkv/pqkWH3sArdavhoK/NURrDkzPa+EwbIDVooWWBbLCBQ8LGbCyOeKp
	   Gov7Dys9bWC8vFML1cH+QDRfDwymdA==
	   -----END CERTIFICATE-----
	*/
	// RSA ECC
	certPEMs3 = [][]byte{
		[]byte(`-----BEGIN CERTIFICATE-----
MIIEXDCCA0SgAwIBAgISA31Wyx67ZKb50EkEq0EmA+/HMA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA4MjUwODU4MDBaFw0x
NzExMjMwODU4MDBaMBUxEzARBgNVBAMTCmRlZXB6ei5jb20wWTATBgcqhkjOPQIB
BggqhkjOPQMBBwNCAASwuEzG6KeJ2WiPgSf8nSXQGkwJRmQs9QAsufDzergEL+qM
5xKjFN8JNXMkST+FHqLhxrnV5hkdaqm2WYKaqcv5o4ICOjCCAjYwDgYDVR0PAQH/
BAQDAgeAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E
AjAAMB0GA1UdDgQWBBSjpGQwCcUkLkZ6CK4/b23RU1SRBjAfBgNVHSMEGDAWgBSo
SmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBBQUHMAGG
Imh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKG
I2h0dHA6Ly9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMEUGA1UdEQQ+MDyC
D2Jsb2cuZGVlcHp6LmNvbYIKZGVlcHp6LmNvbYINc3QuZGVlcHp6LmNvbYIOd3d3
LmRlZXB6ei5jb20wgf4GA1UdIASB9jCB8zAIBgZngQwBAgEwgeYGCysGAQQBgt8T
AQEBMIHWMCYGCCsGAQUFBwIBFhpodHRwOi8vY3BzLmxldHNlbmNyeXB0Lm9yZzCB
qwYIKwYBBQUHAgIwgZ4MgZtUaGlzIENlcnRpZmljYXRlIG1heSBvbmx5IGJlIHJl
bGllZCB1cG9uIGJ5IFJlbHlpbmcgUGFydGllcyBhbmQgb25seSBpbiBhY2NvcmRh
bmNlIHdpdGggdGhlIENlcnRpZmljYXRlIFBvbGljeSBmb3VuZCBhdCBodHRwczov
L2xldHNlbmNyeXB0Lm9yZy9yZXBvc2l0b3J5LzANBgkqhkiG9w0BAQsFAAOCAQEA
PTgjmYPWm9cfzVgd5GRqbmY3PEQhLzeLF2pTgJFa8u1ZHe3h55mnnOex6X2uEaG6
Q0FxLEw/uBONqjvLwD+nWAhxas4UdalQ7vNgZE49gFOabeni/bPLTheOAwNDXm3j
FYYPntsgdIhzHgYBnJ8+TgUcICAVvjm6f4VlfPyxL9AtQQcKEw21gI3THDGIFDxf
W3LYfKZ5dn5aU/xah0ZRXRhVLV+t/Sbi7bauSdQbQUH+6TTlx6iQ+7teblKD3TLk
jqryxe6s1OmqfEL3MaLjtLoHguegfDNvdcsddLIvO0dRSydY1PVxRmm8IfS5EohS
yZBjO/KwYYAa1fKzQN/i9Q==
-----END CERTIFICATE-----`),
		[]byte(`-----BEGIN CERTIFICATE-----
MIIFJzCCBA+gAwIBAgISA6T98Ph9S/s+c6WJbdNHqbNZMA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA4MjUwODU4MDBaFw0x
NzExMjMwODU4MDBaMBUxEzARBgNVBAMTCmRlZXB6ei5jb20wggEiMA0GCSqGSIb3
DQEBAQUAA4IBDwAwggEKAoIBAQCkt4DhqJCt5IXUvyCyAymefJx8oYK2Pai8myrE
UeQAI8srVUoywqNZ+w3NvW5vcSOVJV8MxAUHcg9q6XwjUKWllCqFX0a4F5Kl54H4
mokTJq2IIYwsRlcdYRjr+0AwC4f5FRuqlhiWwIlzqMSYqfAfhqTEKVYrjKCYX6ko
+JNNf89tdABAOJT945cNzIkkydvYDTBWzrvKJ77mlAWElRkXnMrGVSUVDeLTG/PI
jv5+HS5KKhqxLj1oBb+UuY9cxph97bEceN1q3UD8l7aToe9cNEefUqSegaibUKSl
EIBrBlUeBDm0KBoq/GO1THxmNnFwqvlIUxcT4Iieg4003S1dAgMBAAGjggI6MIIC
NjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC
MAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFLc2VvVXSt649cmh59hP0k9bd0qnMB8G
A1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMwYTAu
BggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9yZzAv
BggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9yZy8w
RQYDVR0RBD4wPIIPYmxvZy5kZWVwenouY29tggpkZWVwenouY29tgg1zdC5kZWVw
enouY29tgg53d3cuZGVlcHp6LmNvbTCB/gYDVR0gBIH2MIHzMAgGBmeBDAECATCB
5gYLKwYBBAGC3xMBAQEwgdYwJgYIKwYBBQUHAgEWGmh0dHA6Ly9jcHMubGV0c2Vu
Y3J5cHQub3JnMIGrBggrBgEFBQcCAjCBngyBm1RoaXMgQ2VydGlmaWNhdGUgbWF5
IG9ubHkgYmUgcmVsaWVkIHVwb24gYnkgUmVseWluZyBQYXJ0aWVzIGFuZCBvbmx5
IGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgQ2VydGlmaWNhdGUgUG9saWN5IGZvdW5k
IGF0IGh0dHBzOi8vbGV0c2VuY3J5cHQub3JnL3JlcG9zaXRvcnkvMA0GCSqGSIb3
DQEBCwUAA4IBAQCa9W6oDm8mXPuHrN6w4UgAqvQmB6Gmrq8uDAdfx4OtWQylDXTe
1fbwQzYQldSFrUxkL86mKVxKs/Cfq21e0bjRSiU9Vi1XypQRGhAgR+B9bgaH2UhE
aTBUwmYFJoTlaXDVEnEcxo1ibGAFOwJbquMl0MenhpLdyec8krsCS5p5/It95CHs
PYBNbFFlAxyiRowcZHoW4OrNl2eVyQ6CZl6PpLO5t13VLcsDSAP4gtbQKQpITE9E
RCh2jhwKwsigKnwbuUsM2P2pIn1lMDIGGq6XpF85LDIrMCMr9GHETOxjxoO+j/Xq
byuaHba+eYSY/3JJz2eOUPbwM3MRx1Z7JiLB
-----END CERTIFICATE-----`),
	}

// resp3 :
/*
-----BEGIN CERTIFICATE-----
MIIEXDCCA0SgAwIBAgISA31Wyx67ZKb50EkEq0EmA+/HMA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA4MjUwODU4MDBaFw0x
NzExMjMwODU4MDBaMBUxEzARBgNVBAMTCmRlZXB6ei5jb20wWTATBgcqhkjOPQIB
BggqhkjOPQMBBwNCAASwuEzG6KeJ2WiPgSf8nSXQGkwJRmQs9QAsufDzergEL+qM
5xKjFN8JNXMkST+FHqLhxrnV5hkdaqm2WYKaqcv5o4ICOjCCAjYwDgYDVR0PAQH/
BAQDAgeAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E
AjAAMB0GA1UdDgQWBBSjpGQwCcUkLkZ6CK4/b23RU1SRBjAfBgNVHSMEGDAWgBSo
SmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBBQUHMAGG
Imh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKG
I2h0dHA6Ly9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMEUGA1UdEQQ+MDyC
D2Jsb2cuZGVlcHp6LmNvbYIKZGVlcHp6LmNvbYINc3QuZGVlcHp6LmNvbYIOd3d3
LmRlZXB6ei5jb20wgf4GA1UdIASB9jCB8zAIBgZngQwBAgEwgeYGCysGAQQBgt8T
AQEBMIHWMCYGCCsGAQUFBwIBFhpodHRwOi8vY3BzLmxldHNlbmNyeXB0Lm9yZzCB
qwYIKwYBBQUHAgIwgZ4MgZtUaGlzIENlcnRpZmljYXRlIG1heSBvbmx5IGJlIHJl
bGllZCB1cG9uIGJ5IFJlbHlpbmcgUGFydGllcyBhbmQgb25seSBpbiBhY2NvcmRh
bmNlIHdpdGggdGhlIENlcnRpZmljYXRlIFBvbGljeSBmb3VuZCBhdCBodHRwczov
L2xldHNlbmNyeXB0Lm9yZy9yZXBvc2l0b3J5LzANBgkqhkiG9w0BAQsFAAOCAQEA
PTgjmYPWm9cfzVgd5GRqbmY3PEQhLzeLF2pTgJFa8u1ZHe3h55mnnOex6X2uEaG6
Q0FxLEw/uBONqjvLwD+nWAhxas4UdalQ7vNgZE49gFOabeni/bPLTheOAwNDXm3j
FYYPntsgdIhzHgYBnJ8+TgUcICAVvjm6f4VlfPyxL9AtQQcKEw21gI3THDGIFDxf
W3LYfKZ5dn5aU/xah0ZRXRhVLV+t/Sbi7bauSdQbQUH+6TTlx6iQ+7teblKD3TLk
jqryxe6s1OmqfEL3MaLjtLoHguegfDNvdcsddLIvO0dRSydY1PVxRmm8IfS5EohS
yZBjO/KwYYAa1fKzQN/i9Q==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/
MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
DkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow
SjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT
GkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EF
q6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8
SMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0
Z8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWA
a6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj
/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0T
AQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG
CCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNv
bTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9k
c3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAw
VAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcC
ARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAz
MDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwu
Y3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsF
AAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJo
uM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/
wApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwu
X4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlG
PfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6
KOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==
-----END CERTIFICATE-----



-----BEGIN CERTIFICATE-----
MIIFJzCCBA+gAwIBAgISA6T98Ph9S/s+c6WJbdNHqbNZMA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA4MjUwODU4MDBaFw0x
NzExMjMwODU4MDBaMBUxEzARBgNVBAMTCmRlZXB6ei5jb20wggEiMA0GCSqGSIb3
DQEBAQUAA4IBDwAwggEKAoIBAQCkt4DhqJCt5IXUvyCyAymefJx8oYK2Pai8myrE
UeQAI8srVUoywqNZ+w3NvW5vcSOVJV8MxAUHcg9q6XwjUKWllCqFX0a4F5Kl54H4
mokTJq2IIYwsRlcdYRjr+0AwC4f5FRuqlhiWwIlzqMSYqfAfhqTEKVYrjKCYX6ko
+JNNf89tdABAOJT945cNzIkkydvYDTBWzrvKJ77mlAWElRkXnMrGVSUVDeLTG/PI
jv5+HS5KKhqxLj1oBb+UuY9cxph97bEceN1q3UD8l7aToe9cNEefUqSegaibUKSl
EIBrBlUeBDm0KBoq/GO1THxmNnFwqvlIUxcT4Iieg4003S1dAgMBAAGjggI6MIIC
NjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC
MAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFLc2VvVXSt649cmh59hP0k9bd0qnMB8G
A1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMwYTAu
BggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9yZzAv
BggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9yZy8w
RQYDVR0RBD4wPIIPYmxvZy5kZWVwenouY29tggpkZWVwenouY29tgg1zdC5kZWVw
enouY29tgg53d3cuZGVlcHp6LmNvbTCB/gYDVR0gBIH2MIHzMAgGBmeBDAECATCB
5gYLKwYBBAGC3xMBAQEwgdYwJgYIKwYBBQUHAgEWGmh0dHA6Ly9jcHMubGV0c2Vu
Y3J5cHQub3JnMIGrBggrBgEFBQcCAjCBngyBm1RoaXMgQ2VydGlmaWNhdGUgbWF5
IG9ubHkgYmUgcmVsaWVkIHVwb24gYnkgUmVseWluZyBQYXJ0aWVzIGFuZCBvbmx5
IGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgQ2VydGlmaWNhdGUgUG9saWN5IGZvdW5k
IGF0IGh0dHBzOi8vbGV0c2VuY3J5cHQub3JnL3JlcG9zaXRvcnkvMA0GCSqGSIb3
DQEBCwUAA4IBAQCa9W6oDm8mXPuHrN6w4UgAqvQmB6Gmrq8uDAdfx4OtWQylDXTe
1fbwQzYQldSFrUxkL86mKVxKs/Cfq21e0bjRSiU9Vi1XypQRGhAgR+B9bgaH2UhE
aTBUwmYFJoTlaXDVEnEcxo1ibGAFOwJbquMl0MenhpLdyec8krsCS5p5/It95CHs
PYBNbFFlAxyiRowcZHoW4OrNl2eVyQ6CZl6PpLO5t13VLcsDSAP4gtbQKQpITE9E
RCh2jhwKwsigKnwbuUsM2P2pIn1lMDIGGq6XpF85LDIrMCMr9GHETOxjxoO+j/Xq
byuaHba+eYSY/3JJz2eOUPbwM3MRx1Z7JiLB
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/
MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
DkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow
SjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT
GkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EF
q6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8
SMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0
Z8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWA
a6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj
/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0T
AQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG
CCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNv
bTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9k
c3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAw
VAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcC
ARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAz
MDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwu
Y3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsF
AAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJo
uM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/
wApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwu
X4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlG
PfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6
KOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==
-----END CERTIFICATE-----
*/
)

func TestIsSelfSigned(t *testing.T) {
	assert := assert.New(t)

	rootCertStr := `-----BEGIN CERTIFICATE-----
MIIDaDCCAlACCQCdoCBEfht4JDANBgkqhkiG9w0BAQsFADB2MQswCQYDVQQGEwJD
TjERMA8GA1UECAwIc2hhbmdoYWkxETAPBgNVBAcMCHNoYW5naGFpMRMwEQYDVQQK
DApoc3VsZWkuY29tMQswCQYDVQQLDAJJVDEfMB0GA1UEAwwWc2VsZi1zaWduZWQu
aHN1bGVpLmNvbTAeFw0xNzA5MjAwOTE5NDdaFw0zNzA5MTUwOTE5NDdaMHYxCzAJ
BgNVBAYTAkNOMREwDwYDVQQIDAhzaGFuZ2hhaTERMA8GA1UEBwwIc2hhbmdoYWkx
EzARBgNVBAoMCmhzdWxlaS5jb20xCzAJBgNVBAsMAklUMR8wHQYDVQQDDBZzZWxm
LXNpZ25lZC5oc3VsZWkuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEA4G/GaxImySgTu/aV0m8/kGGckP6m091D7mFO88m+Jh6dUQ3as74afNoBNZx8
Uky9Utjm/kK5Etkk9cSfZEbQChrXHiZI9Q08E+2eXgyfSQ/j6RMiDolNWBfJG7Oc
B6NCus/4QnnoLeXFjKNYBJ4vU3VSFcq5OlrciA4LUUeWNqtPbwVvX1SMCzliJFLb
oCYxqPvuH2A9l2geXdfgH0RTkFcIL+2J8TJ2u1JWd6tz/xd13zQMHUX+Pi66ot62
Ht4PRDFzcx0ZckOru9mE3cawrFuM8QHijK5+Xm87O5qZHTnnFncS3Cg5DnFdQtgL
4QJxKQ0kZtdG0hNaAFMt8HkXlwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQCjS4Qf
T690d0CQ+41EEToS07MKH/Oe043rfO0ZjeBjNFIfMUS7HJ0vU0jUB2TJV45cQ6An
6bqUwt5Gm57iOhjbHJ5it+0jAw7Q0Xx1dpyFKpSHVSv+yNvRDLLhA7/vwHpTwqju
ysvEuczBWj6BMajF2t5FCh/Eaw+cmSzagl0S9oww4RYPDLCMGOii/Ai5Y01hMxMI
I4PYDZpfo1hjeMrae/1l/DsJcxWeh9+cOQGwfx1BTlNuvdpzI1Y83Hl9xVew64+O
moUDdkcz2xhcWpDkPIeWXZVmWK8VZQIsDF0Kr7EIbtqay6JeSW440LumHbCicB9p
VlIHmeF4seosOUR7
-----END CERTIFICATE-----
`
	notRootCertStr := `-----BEGIN CERTIFICATE-----
MIIEPjCCA+SgAwIBAgIQcvdVDm2ZZyrR7CUFOPTWAjAKBggqhkjOPQQDAjCBmzEL
MAkGA1UEBhMCQ04xJTAjBgNVBAoTHFRydXN0QXNpYSBUZWNobm9sb2dpZXMsIElu
Yy4xHzAdBgNVBAsTFlN5bWFudGVjIFRydXN0IE5ldHdvcmsxHTAbBgNVBAsTFERv
bWFpbiBWYWxpZGF0ZWQgU1NMMSUwIwYDVQQDExxUcnVzdEFzaWEgRUNDIERWIFNT
TCBDQSAtIEc3MB4XDTE3MDkyNTAwMDAwMFoXDTE4MDkyNTIzNTk1OVowFDESMBAG
A1UEAwwJcmF6ZWVuLm1lMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvFd/1d8F
jvhPksfybUYyQY3y1cHTwr2zsnhmTsF4jPf73PyiUrPJPmUZ6eN5JXya62GBMFwV
3KBJwLH7P76rBaOCAo4wggKKMCMGA1UdEQQcMBqCCXJhemVlbi5tZYINd3d3LnJh
emVlbi5tZTAJBgNVHRMEAjAAMGEGA1UdIARaMFgwVgYGZ4EMAQIBMEwwIwYIKwYB
BQUHAgEWF2h0dHBzOi8vZC5zeW1jYi5jb20vY3BzMCUGCCsGAQUFBwICMBkMF2h0
dHBzOi8vZC5zeW1jYi5jb20vcnBhMB8GA1UdIwQYMBaAFNwOeqpvvdQeD0NIXrOs
aXGoPx0FMA4GA1UdDwEB/wQEAwIHgDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYB
BQUHAwIwgZsGCCsGAQUFBwEBBIGOMIGLMDwGCCsGAQUFBzABhjBodHRwOi8vdHJ1
c3Rhc2lhMi1vY3NwLmRpZ2l0YWxjZXJ0dmFsaWRhdGlvbi5jb20wSwYIKwYBBQUH
MAKGP2h0dHA6Ly90cnVzdGFzaWEyLWFpYS5kaWdpdGFsY2VydHZhbGlkYXRpb24u
Y29tL3RydXN0YXNpYWc3LmNydDCCAQUGCisGAQQB1nkCBAIEgfYEgfMA8QB3AN3r
HSt6DU+mIIuBrYFocH4ujp0B1VyIjT0RxM227L7MAAABXrnRWwMAAAQDAEgwRgIh
APUpb/j6CyfoDXX+K94EMreVasCTvvTSpI2ci72jUEPHAiEArWWoUEgSNq9uUuGC
pZT7VzBgVBbZi4JFQhfG8448QJEAdgCkuQmQtBhYFIe7E6LMZ3AKPDWYBPkb37jj
d80OyA3cEAAAAV650Vs7AAAEAwBHMEUCIHcB28FKsQSTof4U0IltFfyBemB0d2JN
6JI1ZmFP8eOjAiEA834prlqFBQgKjrErTLZwToPET7qjqRFONj2DxemlD/YwCgYI
KoZIzj0EAwIDSAAwRQIgH+rqHW5YavkYG0bDS2CLnp5eQTnsZnX9J3Q///453SIC
IQDNOR2TV98z6NpWZ9cSiMR1m9zbyrVqTwfJ/ElvzxbjIg==
-----END CERTIFICATE-----`

	rootCert, ok := certutils.GenCertFromPem([]byte(rootCertStr))
	if !ok {
		log.Panic("无法解析根证书")
	}
	notRootCert, ok := certutils.GenCertFromPem([]byte(notRootCertStr))
	if !ok {
		log.Panic("无法解析非根证书")
	}

	tests := []struct {
		cert   *x509.Certificate
		result bool
	}{
		{rootCert, true},
		{notRootCert, false},
	}

	for _, test := range tests {
		result := isSelfSigned(test.cert)
		assert.Equal(test.result, result)
	}

}
